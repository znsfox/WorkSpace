#### 什么是分布式锁？

分布式锁是控制分布式系统或不同系统之间**共同访问共享资源的**一种**锁**实现



#### **为什么要有分布式锁？**

随着业务发展的需要，原单体单机部署的系统被演化成分布式集群系统后，由于分布式系统多线程，多进程，并且分布在不同机器上，这将使原单机部署情况下的并发控制锁策略失效，单纯的应用并不能提供分布式锁的能力。

因此需要一种跨机器的互斥机制来控制共享资源的访问，保证**同一个方法**的**同一操作**只能被**一台机器**上的**一个线程**执行。



#### 设计要求

1、可**重入**锁（避免死锁）

2、获取锁和释放锁 **高可用**

3、获取锁和释放锁 **高性能**



#### 分布式锁可用的三个条件：

1、互斥性。在任意时刻，**只有一个客户端能持有锁**。

2、不会发生死锁。即使有一个客户端在持有锁的过程中发生崩溃导致无法解锁，也能保证其他客户端持续加锁

3、解铃还须系铃人。**加锁和解锁必须是同一个客户端**。



实现分布式锁的方式：

1、采用lua脚本操作分布式锁

2、采用setnx,setex命令连用的方式实现分布式锁



### Spring Cache:

在很多场景中，通常获取前后相同或更新不频繁的数据，比如访问产品信息数据、网页数据，如果没有使用缓存，则访问每次都需要重新请求数据库，这会导致大部分的时间都耗费在数据库的查询和方法调用上，因为数据库进行I/O操作非常耗费时间，这就可以利用Spring Cache来解决。



Spring Cache是Spring一整套缓存方案。它本身并不提供缓存实现，而是提供统一的接口和代码规范、配置、注解等，以便整合各种Cache方案，使用户不用关心Cache的细节。



Spring支持“透明”地向应用程序中添加缓存，将缓存应用于方法，在方法执行前检查缓存中是否有可用的数据。这样可以减少方法执行的次数，同时提高响应的速度。缓存的应用方式“透明”，不会对应用者造成任何干扰。

**只要通过@EnableCaching启用了缓存支持，Spring Boot会自动处理好缓存的基本配置。**



Spring Cache作用在方法上。当调用一个缓存方法时，会把该方法参数和返回结果作为一个键值对存放在缓存中，下次用同样的参数来调用该方法将不再执行方法而是直接从缓存中获取结果进行返回。



所以在使用Spring Cache时，要保证在缓存的方法和方法参数相同时返回相同的的结果。



使用过程：

1. 添加依赖
2. 配置缓存管理器
3. 开启缓存功能
4. 在服务实现里编写缓存业务逻辑
5. 控制器里面调用缓存服务



###  EhCache

EhCache是一种广泛使用的Java分布式缓存，它具有内存和磁盘存储，缓存，缓存加载器、缓存扩展、缓存异常处理，GZIP缓存 、Servlet过滤器，以及支持RESTt和SOAP API等特点。



### Caffeine

基于LRU算法实现，支持多种缓存过期策略。





### Redis:

cache和Redis可以一起用，Spring Boot支持把Cache存到Redis里，如果是单服务器，则用Cache、Ehcache、或Caffeine，性能更高也能满足需求，如果是服务器集群，则使用Redis，这样的话性能更高



REDIS是key-value存储系统，纟纟以                             